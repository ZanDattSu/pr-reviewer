### Требования

- **Go** ≥ `1.24`
- Docker
- **Taskfile CLI** → [инструкция по установке](https://taskfile.dev/#/installation)

### Проблемы, с которыми столкнулся
##### 1.
- Проблема:
  - При обращении к эндпойнту (например, /health) через localhost:8080 Postman выдавал “socket hang up”. Контейнер запускался успешно, порты были проброшены, но сервис извне оставался недоступным.
- Задача:
  - Обеспечить корректный доступ к HTTP‑серверу из хоста через проброшенные порты Docker.
- Действия:
  - Выяснил, что в коде сервер слушал адрес localhost:8080. В Docker‑контейнере это означает, что сервер слушает только локальные соединения внутри контейнера, а обращения снаружи (по проброшенному порту) не принимаются.
  - Изменил привязку на 0.0.0.0:8080, чтобы сервер слушал все интерфейсы контейнера.
- Результат:
  - После изменения сервис стал корректно доступен по localhost:8080 на хосте, и проблема с Postman была полностью решена. 

##### 2.
- Проблема:
  - Автогенерированный OpenAPI-интерфейс требует одной структуры-обработчика для всех эндпоинтов, что приводит к громоздкому и неудобному для поддержки коду.
- Задача:
  - Разделить бизнес-логику по доменным областям, сохранив совместимость с единым OpenAPI-интерфейсом.
- Действия:
  - Вынес доменные обработчики (PullRequest, Team, User) в отдельные пакеты с чистой бизнес-логикой. 
  - Реализовал агрегирующий Api, который делегирует вызовы соответствующим domain handler’ам и удовлетворяет OpenAPI-интерфейсу.
- Результат:
  - Архитектура стала чистой, легко масштабируемой и поддерживаемой, а сервис полностью совместим с автогенерируемым OpenAPI-сервером.

##### 3.
  - Проблема:
    - Нужно определить, какой ключ использовать для таблицы `teams` в базе данных:
      оставить `team_name` в качестве первичного ключа или ввести отдельный суррогатный `team_id` типа UUID. 
    - Решение должно учитывать текущее API, будущие фичи и масштабируемость сервиса.

  - Действия:
    - Проанализировал OpenAPI-контракт: API оперирует только `team_name`, и это бизнес-ключ, но может потребоваться переименование. 
    - Оценил риски использования строкового PK: 
      - высокие накладные расходы строковых индексов, 
      - сложность каскадных обновлений при переименованиях, 
      - невозможность безопасно масштабировать сервис.
    - Принял решение использовать схему с суррогатным первичным ключом `team_id` UUID, оставив `team_name` уникальным бизнес-атрибутом.
 
  - Результат:
    - Получилась гибкая и масштабируемая схема БД:
    - `team_id` UUID стал стабильным первичным ключом, 
    - `team_name` сохранил уникальность для API, 
    - Решена проблема потенциальных каскадных обновлений, 
    - Архитектура стала консистентной с остальными частями проекта, где уже используются UUID-идентификаторы, что упрощает поддержку и развитие сервиса.

### CI/CD

Проект использует GitHub Actions. Основные workflow:

- **CI** (`.github/workflows/ci.yml`) - проверяет код при каждом push и pull request
    - Запуск линтера golangci-lint

### Конфигурация линтера (golangci-lint)

**Линтер автоматически запускается через Taskfile и в CI (GitHub Actions).**

##### Общие настройки

| Параметр                | Значение   | Назначение                                                                   |
|-------------------------|------------|------------------------------------------------------------------------------|
| `timeout`               | `5m`       | Максимальное время работы линтеров.                                          |
| `relative-path-mode`    | `gomod`    | Путь к файлам выводится относительно корня go-модуля.                        |
| `issues-exit-code`      | `1`        | При наличии ошибок процесс завершается кодом `1` (удобно для CI).            |
| `tests`                 | `true`     | Анализируются также файлы `*_test.go`.                                       |
| `modules-download-mode` | `readonly` | Запрещена загрузка зависимостей во время анализа (быстрее и надёжнее на CI). |

##### Формат вывода

Вывод линтера цветной и показывает строку, где найдена проблема.

| Параметр             | Значение | Назначение                                         |
|----------------------|----------|----------------------------------------------------|
| `print-linter-name`  | `true`   | Показывать имя линтера                             |
| `print-issued-lines` | `true`   | Показывать строку кода, где найдена проблема       |
| `colors`             | `true`   | Использовать цветной вывод (для лучшей читаемости) |

##### Правила обработки ошибок

| Параметр                | Значение | Назначение                                                                                    |
|-------------------------|----------|-----------------------------------------------------------------------------------------------|
| `max-issues-per-linter` | `0`      | Без лимита на количество ошибок от одного линтера.                                            |
| `max-same-issues`       | `0`      | Без лимита на количество одинаковых ошибок.                                                   |
| `uniq-by-line`          | `true`   | Отображать максимум одну ошибку на строку (избегает спама от разных линтеров по одной строке) |

##### Включённые линтеры

| Линтер         | Назначение                                                                  |
|----------------|-----------------------------------------------------------------------------|
| `errcheck`     | Проверяет, что ошибки не игнорируются.                                      |
| `staticcheck`  | Расширенный статический анализ (включает `gosimple`, `stylecheck`).         |
| `govet`        | Встроенный в Go инструмент анализа (ловит потенциальные баги).              |
| `gocritic`     | Набор продвинутых правил для улучшения качества кода.                       |
| `revive`       | Проверяет стиль кода, оформление, названия.                                 |
| `unused`       | Находит неиспользуемые переменные, типы, функции.                           |
| `gosec`        | Проверка на уязвимости и небезопасные практики.                             |
| `depguard`     | Запрещает импорт указанных пакетов (контроль зависимостей).                 |
| `bodyclose`    | Проверяет, что закрывается `resp.Body` у HTTP-запросов.                     |
| `asciicheck`   | Предупреждает о не-ASCII символах в коде.                                   |
| `cyclop`       | Контролирует цикломатическую сложность функций.                             |
| `dupl`         | Находит дублированные фрагменты кода.                                       |
| `ineffassign`  | Обнаруживает неиспользуемые присваивания.                                   |
| `unparam`      | Находит неиспользуемые параметры функций.                                   |
| `errorlint`    | Рекомендует использовать `errors.Is` / `errors.As` вместо прямых сравнений. |
| `errname`      | Проверяет имена переменных/типов ошибок (должны содержать "Err").           |
| `forbidigo`    | Запрещает определённые вызовы или конструкции по regex-паттернам.           |
| `contextcheck` | Проверяет, что `context.Context` передаётся в методы/функции.               |
| `containedctx` | Предупреждает, если `context.Context` сохраняется в структуре.              |

##### Отключённые линтеры

| Линтер    | Назначение                                    |
|-----------|-----------------------------------------------|
| `gocyclo` | Старый линтер сложности (заменён на cyclop).  |
| `lll`     | Проверка длины строк (часто шумная и мешает). |

##### Исключения из анализа

``` yaml
exclusions:
  generated: strict  # Игнорируются файлы с префиксом "// Code generated ... DO NOT EDIT."
  rules:
    - path: _test\.go # Для всех тестов:
      linters:
          - cyclop     # Не проверять сложность тестов
          - dupl       # Не проверять дублирование в тестах
          - gosec      # Не искать уязвимости в тестах
```

##### Индивидуальные настройки для конкретных линтеров

| Линтер      | Ключевые параметры и назначение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `gosec`     | `audit: true` &mdash; активировать все правила безопасности; <br/>`show-ignored: true` &mdash; показывать проигнорированные проблемы в комментариях; <br/> `severity: medium`, `confidence: medium` &mdash; отсекаем низкоприоритетные/неуверенные срабатывания.                                                                                                                                                                                                                                                        |
| `cyclop`    | `max-complexity: 20` &mdash; допустимая цикломатическая сложность функции повышена до 20 (чуть строже, чем при полном отсутствии лимита, но мягче, чем значение 10 по умолчанию).                                                                                                                                                                                                                                                                                                                                       |
| `depguard`  | `deny: io/ioutil` &mdash; запрещён устаревший пакет **`io/ioutil`** (рекомендуется использовать аналоги из `os`/`io`); параметр `desc` выводит поясняющее сообщение при нарушении.                                                                                                                                                                                                                                                                                                                                      |
| `revive`    | `severity: warning` &mdash; все замечания `revive` трактуются как предупреждения, а не блокирующие ошибки, позволяя постепенно приводить стиль кода к стандарту.                                                                                                                                                                                                                                                                                                                                                        |
| `forbidigo` | `exclude-godoc-examples: true` &mdash; не применять запреты к Godoc-примерам; <br/>`analyze-types: true` &mdash; искать запреты и в типах/константах, а не только в функциях; <br/> `forbid:` &mdash; список запрещённых паттернов; <br> - `fmt.Print*` &mdash; запрет прямого вывода, требуем структурированный логгер; <br> - `time.Sleep` &mdash; нельзя в продакшене, нужно использовать таймеры/контекст; <br> - `http.DefaultClient` &mdash; небезопасен без таймаутов, нужно создать собственный `*http.Client`. |

##### Форматеры

| Параметр                              | Значение                           | Назначение                                                                                                                                                                      |
|---------------------------------------|------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`enable`**                          | `gofumpt`, `gci`                   | Автоматические форматтеры кода. <br/> `gofumpt` &mdash; cтрогая версия gofmt с дополнительными правилами <br/> `gci` &mdash; форматтер импортов (гибкая альтернатива goimports) |
| **`settings.gofumpt.extra-rules`**    | `true`                             | Более строгие правила (например, удаление лишних пустых строк).                                                                                                                 |
| **`settings.gci.sections`**           | `Standard`, `Default`, `Prefix(…)` | Группировка импортов: <br/> 1.Стандартная библиотека <br/> 2.Сторонние зависимости <br/> 3.Локальные импорты проекта.                                                           |
| **`settings.gci.no-inline-comments`** | `false`                            | Разрешить комментарии после импортов (true — запретит).                                                                                                                         |

